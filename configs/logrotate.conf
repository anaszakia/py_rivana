# Log Rotation Configuration for Hidrologi ML
# Location: /etc/logrotate.d/hidrologi-api

/home/hidrologi/project_hidrologi_ml/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs
    compress
    delaycompress
    
    # Don't rotate if log is empty
    notifempty
    
    # Don't error if log is missing
    missingok
    
    # Create new log file with these permissions
    create 644 hidrologi hidrologi
    
    # Run after rotation
    postrotate
        # Reload service to reopen log files
        systemctl reload hidrologi-api.service > /dev/null 2>&1 || true
    endscript
    
    # Size limit (rotate if > 100MB even if not daily)
    maxsize 100M
}

# Nginx logs for Hidrologi API
/var/log/nginx/hidrologi_*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    missingok
    create 640 www-data adm
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 `cat /var/run/nginx.pid`
        fi
    endscript
}
